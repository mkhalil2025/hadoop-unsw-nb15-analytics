# Hadoop Environment Configuration for UNSW-NB15 Analytics
# This file contains Hadoop-specific configurations for the big data analytics environment
# Optimized for student laptops (8-16GB RAM) and containerized deployment

#==============================================================================
# CORE HADOOP CONFIGURATION
#==============================================================================

# Hadoop Installation Paths
HADOOP_HOME=/opt/hadoop-3.2.1
HADOOP_CONF_DIR=/opt/hadoop/etc/hadoop
HADOOP_LOG_DIR=/opt/hadoop/logs
JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64

# Cluster Identification
CLUSTER_NAME=hadoop-cluster

#==============================================================================
# HDFS CONFIGURATION
#==============================================================================

# Core HDFS Settings
CORE_CONF_fs_defaultFS=hdfs://namenode:8020
HDFS_CONF_dfs_namenode_name_dir=file:///hadoop/dfs/name
HDFS_CONF_dfs_datanode_data_dir=file:///hadoop/dfs/data
HDFS_CONF_dfs_replication=1

# HDFS Security & Permissions (Development Mode)
HDFS_CONF_dfs_permissions_enabled=false
HDFS_CONF_dfs_webhdfs_enabled=true

# HDFS Performance Optimization
HDFS_CONF_dfs_block_size=67108864
HDFS_CONF_dfs_client_block_write_replace_datanode_on_failure_policy=NEVER

# HDFS Memory Settings (Optimized for Student Laptops)
HADOOP_NAMENODE_OPTS=-Xmx1024m -Xms512m
HADOOP_DATANODE_OPTS=-Xmx512m -Xms256m

#==============================================================================
# YARN CONFIGURATION
#==============================================================================

# YARN Core Settings
YARN_CONF_yarn_resourcemanager_hostname=resourcemanager
YARN_CONF_yarn_nodemanager_aux_services=mapreduce_shuffle

# YARN Memory Allocation (Adjustable based on system resources)
# For 8GB systems, use these values:
YARN_CONF_yarn_nodemanager_resource_memory_mb=4096
YARN_CONF_yarn_scheduler_maximum_allocation_mb=4096
YARN_CONF_yarn_scheduler_minimum_allocation_mb=512

# For 16GB+ systems, uncomment these lines:
# YARN_CONF_yarn_nodemanager_resource_memory_mb=8192
# YARN_CONF_yarn_scheduler_maximum_allocation_mb=8192

# YARN CPU Allocation
YARN_CONF_yarn_nodemanager_resource_cpu_vcores=2

# YARN Service Memory Settings
YARN_RESOURCEMANAGER_HEAPSIZE=1024
YARN_NODEMANAGER_HEAPSIZE=1024

# Additional YARN Performance Settings
YARN_NODEMANAGER_RESOURCE_MEMORY_MB=4096
YARN_NODEMANAGER_RESOURCE_CPU_VCORES=2
YARN_SCHEDULER_MAXIMUM_ALLOCATION_MB=4096
YARN_SCHEDULER_MINIMUM_ALLOCATION_MB=512

#==============================================================================
# MAPREDUCE CONFIGURATION
#==============================================================================

# MapReduce Framework
MAPRED_CONF_mapreduce_framework_name=yarn

# MapReduce Memory Settings (Memory Optimized)
MAPRED_CONF_mapreduce_map_memory_mb=1024
MAPRED_CONF_mapreduce_reduce_memory_mb=2048

# MapReduce JVM Settings
MAPRED_CONF_mapreduce_map_java_opts=-Xmx768m
MAPRED_CONF_mapreduce_reduce_java_opts=-Xmx1536m

# MapReduce Performance Tuning
MAPRED_CONF_mapreduce_job_reduce_slowstart_completedmaps=0.8
MAPRED_CONF_mapreduce_task_io_sort_mb=256
MAPRED_CONF_mapreduce_task_io_sort_factor=100

#==============================================================================
# HIVE CONFIGURATION
#==============================================================================

# Hive Installation Paths
HIVE_HOME=/opt/hive
HIVE_CONF_DIR=/opt/hive/conf

# Hive Metastore Configuration
HIVE_METASTORE_DRIVER=org.postgresql.Driver
HIVE_METASTORE_JDBC_URL=jdbc:postgresql://postgres:5432/metastore
HIVE_METASTORE_JDBC_USER=hive
HIVE_METASTORE_JDBC_PASSWORD=hive123

# Hive Service Memory Settings
HIVE_METASTORE_HEAPSIZE=512m
HIVE_SERVER2_HEAPSIZE=1024m

#==============================================================================
# POSTGRESQL METASTORE CONFIGURATION
#==============================================================================

# PostgreSQL Connection Settings
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=metastore
POSTGRES_USER=hive
POSTGRES_PASSWORD=hive123

#==============================================================================
# PERFORMANCE TUNING
#==============================================================================

# I/O Optimization
CORE_CONF_io_file_buffer_size=65536

# Compression Settings
CORE_CONF_io_compression_codecs=org.apache.hadoop.io.compress.DefaultCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec,org.apache.hadoop.io.compress.SnappyCodec

# Network Optimization
CORE_CONF_ipc_client_connect_max_retries=10
CORE_CONF_ipc_client_connect_retry_interval=1000

#==============================================================================
# SECURITY CONFIGURATION (Development Mode)
#==============================================================================

# Authentication (Simple for development)
HADOOP_SECURITY_AUTHENTICATION=simple

# Proxy User Settings for Hive Integration
CORE_CONF_hadoop_proxyuser_hive_hosts=*
CORE_CONF_hadoop_proxyuser_hive_groups=*
CORE_CONF_hadoop_proxyuser_root_hosts=*
CORE_CONF_hadoop_proxyuser_root_groups=*

#==============================================================================
# LOGGING CONFIGURATION
#==============================================================================

# Log Levels (Adjust for debugging)
HADOOP_ROOT_LOGGER=INFO,console
YARN_ROOT_LOGGER=INFO,console
HIVE_ROOT_LOGGER=INFO,console

# Log Rotation
HADOOP_LOG_MAXFILESIZE=256MB
HADOOP_LOG_MAXBACKUPINDEX=20

#==============================================================================
# ENVIRONMENT-SPECIFIC SETTINGS
#==============================================================================

# For Development/Student Use
HADOOP_SHELL_MISSING_JAVA_OK=1
HADOOP_OPTS=-Djava.net.preferIPv4Stack=true

# Container-specific Settings
HADOOP_CLASSPATH=$HADOOP_HOME/share/hadoop/tools/lib/*

#==============================================================================
# UNSW-NB15 DATASET SPECIFIC SETTINGS
#==============================================================================

# HDFS Paths for UNSW-NB15 Dataset
UNSW_DATA_PATH=/user/data/unsw_nb15
UNSW_HIVE_WAREHOUSE=/user/hive/warehouse/unsw_nb15.db
UNSW_OUTPUT_PATH=/user/output

# Hive Database Configuration
HIVE_DB_NAME=unsw_nb15
HIVE_TABLE_NAME=network_flows

#==============================================================================
# MEMORY SCALING GUIDELINES
#==============================================================================

# System Memory: 8GB
# - YARN NodeManager: 4GB
# - YARN Scheduler Max: 4GB
# - MapReduce Map: 1GB
# - MapReduce Reduce: 2GB

# System Memory: 16GB
# - YARN NodeManager: 8GB
# - YARN Scheduler Max: 8GB
# - MapReduce Map: 2GB
# - MapReduce Reduce: 4GB

# To switch between configurations, update the YARN memory settings above
# and restart the services with: docker-compose restart